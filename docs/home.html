<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="home.css">
</head>
<body>
    <div class="header-home">
        <a href = "index.html">
            <img src="images/logo.png" alt="Energy FM 106.3 Naga Logo" class="logo">
        </a>

        <input type="checkbox" id="menu-toggle">
        <label for="menu-toggle" class="menu-icon">&#9776;</label>

        <div class="dropdown-menu">
            <a href="about.html">About</a>
            <a href="profiles.html">Profiles</a>
            <a href="programs.html">Programs</a>
            <a href="stream.html">Stream</a>
            <a href="news.html">News</a>
        </div>
    </div>

    <div class="banner">
        <h2>BASTA ENERGY, NUMBER 1 PIRMI!</h2>

        <div class="hosts-home">
            <img style="width: 850px; height: auto;" src="images/EFDJS.png">
        </div>

        <div class="listen">
            <button id="liveBtn" class="listen-button">
                <div class="listen-title"><img src = "images/play_button.svg" class = "play">LISTEN LIVE HERE   <img src = "images/listen_live.svg"></div>
                <div class="listen-subtitle">On Air: Loading...</div>
            </button>

            <!-- Hidden audio tag -->
            <audio id="liveAudio">
                <source src="https://stream.zeno.fm/klewk28qlqquv.m3u" type="audio/mpeg">
            </audio>
        </div>
    </div>

    <div class = "break-box"></div>
    <div class="section-title">FEATURED PROGRAMS</div>
    <div class="programs">

        <div class="program-card-home">
            <div class="program-header">GOOD MORNING ENERGY | WEEKDAYS, SAT</div>
            <div>Time: 12:00 AM â€“ 5:00 AM</div>
            <div>Music Only ðŸŽ§</div>
        </div>

        <div class="program-card-home">
            <div class="program-header">GOOD MORNING ENERGY | WEEKDAYS, SAT</div>
            <div>Time: 12:00 AM â€“ 5:00 AM</div>
            <div>Music Only ðŸŽ§</div>
        </div>

        <div class="program-card-home">
            <div class="program-header">GOOD MORNING ENERGY | WEEKDAYS, SAT</div>
            <div>Time: 12:00 AM â€“ 5:00 AM</div>
            <div>Music Only ðŸŽ§</div>
        </div>

        <div class="program-card-home">
            <div class="program-header">GOOD MORNING ENERGY | WEEKDAYS, SAT</div>
            <div>Time: 12:00 AM â€“ 5:00 AM</div>
            <div>Music Only ðŸŽ§</div>
        </div>
    </div>

    <div class="section-title-news">LATEST NEWS UPDATES</div>
    <div class="news">
        <div class="news-card-home">
            <img src = "images/typhoon_photo.png" width = "325" height = "300">
            <div class="news-header">BAGYONG UWAN 2025</div>
            <div>Inquirer News | November 8, 2025</div>
            <div>By: Keith Clores</div>
        </div>

        <div class="news-card-home">
            <img src = "images/typhoon_photo.png" width = "325" height = "300">
            <div class="news-header">BAGYONG UWAN 2025</div>
            <div>Inquirer News | November 8, 2025</div>
            <div>By: Keith Clores</div>
        </div>

        <div class="news-card-home">
            <img src = "images/typhoon_photo.png" width = "325" height = "300">
            <div class="news-header">BAGYONG UWAN 2025</div>
            <div>Inquirer News | November 8, 2025</div>
            <div>By: Keith Clores</div>
        </div>

        <div class="news-card-home">
            <img src = "images/typhoon_photo.png" width = "325" height = "300">
            <div class="news-header">BAGYONG UWAN 2025</div>
            <div>Inquirer News | November 8, 2025</div>
            <div>By: Keith Clores</div>
        </div>
    </div>

<script>
const audio = document.getElementById("liveAudio");
const btn   = document.getElementById("liveBtn");
const title = btn.querySelector(".listen-title");
let isPlaying = false;

function setPlayState() {
    title.innerHTML = `<img src="images/play_button.svg" class="play"> LISTEN LIVE HERE <img src="images/listen_live.svg">`;
}
function setPauseState() {
    title.innerHTML = `<img src="images/pause_button.svg" class="pause"> PAUSE LIVE STREAM <img src="images/listen_live.svg">`;
}

btn.addEventListener("click", () => {
    if (!isPlaying) { audio.play(); isPlaying = true; setPauseState(); }
    else { audio.pause(); isPlaying = false; setPlayState(); }
});
setPlayState();

// ============================
// FETCH PROGRAM DATA
// ============================
Promise.all([
    fetch('http://localhost:8000/backend/fetch.php?table=PROGRAM').then(r => r.json()),
    fetch('http://localhost:8000/backend/fetch.php?table=Program_Day_Type').then(r => r.json()),
    fetch('http://localhost:8000/backend/fetch.php?table=Day_Type').then(r => r.json()),
    fetch('http://localhost:8000/backend/fetch.php?table=Program_Anchor_Assignment').then(r => r.json()),
    fetch('http://localhost:8000/backend/fetch.php?table=DJ_Profile').then(r => r.json())
]).then(([programs, programDayTypes, dayTypes, assignments, djs]) => {
    const subtitle = document.querySelector(".listen-subtitle");
    const container = document.querySelector(".programs");
    container.innerHTML = ""; // clear cards

    const now = new Date();
    const day = now.getDay();
    const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
    const map = { WEEKDAYS: [1,2,3,4,5], SAT: [6], SUN: [0] };

    const formatToSec = t => {
        const [h,m,s] = t.split(':').map(Number);
        return h*3600 + m*60 + (s||0);
    };

    const getDays = id =>
        programDayTypes
            .filter(p => p.PROGRAM_ID == id)
            .map(p => dayTypes.find(d => d.ID == p.DAY_TYPE_ID)?.DAY_TYPE)
            .filter(Boolean);

    const getHosts = id =>
        assignments
            .filter(a => a.PROGRAM_ID == id)
            .map(a => {
                const dj = djs.find(d => d.ID == a.DJ_ID);
                return dj?.STAGE_NAME || dj?.REAL_NAME?.toUpperCase();
            })
            .filter(Boolean)
            .join(", ");

    // ======= Currently On Air / Next Program =======
    const isNowOnAir = program => {
        const start = formatToSec(program.START_TIME);
        const end = formatToSec(program.END_TIME);
        const days = getDays(program.ID);
        const fitsDay = days.some(d => map[d]?.includes(day));
        const withinTime = start < end ? nowSec >= start && nowSec <= end : nowSec >= start || nowSec <= end;
        return fitsDay && withinTime;
    };

    const onAir = programs.find(p => isNowOnAir(p));
    if (onAir) subtitle.textContent = `On Air: ${onAir.TITLE}`;
    else {
        const upcoming = programs
            .filter(p => getDays(p.ID).some(d => map[d]?.includes(day)))
            .sort((a,b) => formatToSec(a.START_TIME) - formatToSec(b.START_TIME))
            .find(p => formatToSec(p.START_TIME) > nowSec);
        subtitle.textContent = upcoming ? `Next: ${upcoming.TITLE} at ${upcoming.START_TIME}` : "No Active Program";
    }

    // ======= Featured Programs with Hosts =======
    programs
        .map(p => ({
            ...p,
            hosts: getHosts(p.ID)
        }))
        .filter(p => p.hosts.length > 0) // only programs with hosts
        .slice(0, 6) // limit to 6 programs
        .forEach(program => {
            const card = document.createElement("div");
            card.className = "program-card-home";

            const days = getDays(program.ID).join(", ");

            card.innerHTML = `
                <div class="program-header">${program.TITLE} | ${days}</div>
                <div>Time: ${program.START_TIME} â€“ ${program.END_TIME}</div>
                <div>Hosts: ${program.hosts}</div>
            `;

            card.addEventListener("click", () => {
    window.location.href = "programs.html";
});

            container.appendChild(card);
        });

}).catch(err => console.error(err));

</script>

    </body>
    <div class = "footer">
        <footer>Privacy Policy | Energy FM Â© 2025</footer>
    </div>
</html>

